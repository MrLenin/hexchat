<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="12.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup Label="Configuration">
    <PlatformToolset>v143</PlatformToolset>
    <ConfigurationType>Application</ConfigurationType>
  </PropertyGroup>
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <ProjectGuid>{C9B735E4-75BC-45AC-A5E3-39A6D076F912}</ProjectGuid>
    <RootNamespace>copy</RootNamespace>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  <Import Project="..\hexchat.props" />

  <!-- Detect GTK version from OwnFlags -->
  <PropertyGroup>
    <IsGTK4>false</IsGTK4>
    <IsGTK4 Condition="$(OwnFlags.Contains('HC_GTK4'))">true</IsGTK4>
  </PropertyGroup>

  <!-- Common files (both GTK3 and GTK4) -->
  <ItemGroup>
    <!-- GLib/GTK core DLLs from gvsbuild -->
    <None Include="$(DepsRoot)\bin\cairo-2.dll" />
    <None Include="$(DepsRoot)\bin\freetype-6.dll" />
    <None Include="$(DepsRoot)\bin\fribidi-0.dll" />
    <None Include="$(DepsRoot)\bin\fontconfig-1.dll" />
    <None Include="$(DepsRoot)\bin\gdk_pixbuf-2.0-0.dll" />
    <None Include="$(DepsRoot)\bin\gio-2.0-0.dll" />
    <None Include="$(DepsRoot)\bin\glib-2.0-0.dll" />
    <None Include="$(DepsRoot)\bin\gmodule-2.0-0.dll" />
    <None Include="$(DepsRoot)\bin\gobject-2.0-0.dll" />
    <None Include="$(DepsRoot)\bin\gspawn-win$(PlatformArchitecture)-helper.exe" />
    <None Include="$(DepsRoot)\bin\gspawn-win$(PlatformArchitecture)-helper-console.exe" />
    <None Include="$(DepsRoot)\bin\gthread-2.0-0.dll" />
    <None Include="$(DepsRoot)\bin\harfbuzz.dll" />
    <None Include="$(DepsRoot)\bin\iconv.dll" />
    <None Include="$(DepsRoot)\bin\ffi-8.dll" />
    <None Include="$(DepsRoot)\bin\intl.dll" />
    <None Include="$(DepsRoot)\bin\libpng16.dll" />
    <None Include="$(DepsRoot)\bin\xml2-16.dll" />
    <None Include="$(DepsRoot)\bin\pango-1.0-0.dll" />
    <None Include="$(DepsRoot)\bin\pangocairo-1.0-0.dll" />
    <None Include="$(DepsRoot)\bin\pangoft2-1.0-0.dll" />
    <None Include="$(DepsRoot)\bin\pangowin32-1.0-0.dll" />
    <None Include="$(DepsRoot)\bin\pcre2-8-0.dll" />
    <None Include="$(DepsRoot)\bin\zlib1.dll" />
    <None Include="$(DepsRoot)\bin\epoxy-0.dll" />
    <!-- OpenSSL from separate install -->
    <None Include="$(OpenSSLRoot)\bin\libcrypto-3-x64.dll" />
    <None Include="$(OpenSSLRoot)\bin\libssl-3-x64.dll" />
    <!-- CA certificate bundle for SSL verification (optional - download from https://curl.se/ca/cacert.pem) -->
    <CACert Include="$(YourCACertPath)" Condition="Exists('$(YourCACertPath)')" />
    <!-- WinSparkle -->
    <None Include="$(WinSparklePath)\WinSparkle.dll" />
    <!-- URL shortcuts -->
    <None Include="changelog.url" />
    <None Include="readme.url" />
    <!-- Lua support (optional - may not be installed) -->
    <LuaExe Include="$(DepsRoot)\bin\lua51.dll" Condition="Exists('$(DepsRoot)\bin\lua51.dll')" />
    <LuaExe Include="$(DepsRoot)\bin\girepository-1.0-1.dll" Condition="Exists('$(DepsRoot)\bin\girepository-1.0-1.dll')" />
    <LuaLib Include="$(DepsRoot)\lib\lua\**\*.dll" />
    <LuaShare Include="$(DepsRoot)\share\lua\*.lua" />
    <LuaShare Include="$(DepsRoot)\share\lua\**\*.lua" />
    <LuaShare Include="$(DepsRoot)\share\lua\**\**\*.lua" />
    <Typelib Include="$(DepsRoot)\lib\girepository-1.0\*.typelib" />
    <!-- Config and data -->
    <FontConfig Include="$(DepsRoot)\etc\fonts\*" />
    <Share Include="share\**\*" />
    <DepsRootDocs Include="$(DepsRoot)\share\doc\**\*" />
    <Locale Include="$(HexChatBin)locale\**\*;$(DepsRoot)\share\locale\**\*" />
    <MSWindowsTheme Include="$(DepsRoot)\share\themes\MS-Windows\**\*" />
    <PythonCffi Include="$(Python3Path)\Lib\site-packages\_cffi_backend*.pyd" />
  </ItemGroup>

  <!-- GTK3-specific files -->
  <ItemGroup Condition="'$(IsGTK4)' == 'false'">
    <None Include="$(DepsRoot)\bin\gtk-3-0.dll" />
    <None Include="$(DepsRoot)\bin\gdk-3-0.dll" />
    <None Include="$(DepsRoot)\bin\atk-1.0-0.dll" />
    <None Include="$(DepsRoot)\bin\libenchant-2.dll" />
    <Gtk3Engines Include="$(DepsRoot)\lib\gtk-3.0\$(PlatformArchitecture)\engines\**\*" />
  </ItemGroup>

  <!-- GTK4-specific files -->
  <ItemGroup Condition="'$(IsGTK4)' == 'true'">
    <None Include="$(DepsRoot)\bin\gtk-4-1.dll" />
    <None Include="$(DepsRoot)\bin\graphene-1.0-0.dll" />
    <!-- Enchant is optional - may be installed separately -->
    <OptionalFiles Include="$(DepsRoot)\bin\libenchant-2.dll" Condition="Exists('$(DepsRoot)\bin\libenchant-2.dll')" />
  </ItemGroup>

  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <Target Name="Build">
    <Copy SourceFiles="@(None)" DestinationFolder="$(HexChatRel)" />
    <Copy SourceFiles="@(OptionalFiles)" DestinationFolder="$(HexChatRel)" />
    <Copy SourceFiles="@(LuaExe)" DestinationFolder="$(HexChatRel)" />
    <Copy SourceFiles="@(PythonCffi)" DestinationFolder="$(HexChatRel)" />
    <Copy SourceFiles="@(FontConfig)" DestinationFolder="$(HexChatRel)\etc\fonts" />
    <!-- GTK3 theme engines -->
    <Copy Condition="'$(IsGTK4)' == 'false'" SourceFiles="@(Gtk3Engines)" DestinationFiles="@(Gtk3Engines->'$(HexChatRel)\lib\gtk-3.0\$(PlatformArchitecture)\engines\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Copy SourceFiles="@(Share)" DestinationFiles="@(Share->'$(HexChatRel)\share\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Copy SourceFiles="..\..\COPYING" DestinationFolder="$(HexChatRel)\share\doc\hexchat" />
    <Copy SourceFiles="$(WinSparklePath)\COPYING" DestinationFolder="$(HexChatRel)\share\doc\WinSparkle" />
    <!-- Enchant hunspell provider (optional) -->
    <Copy SourceFiles="$(DepsRoot)\lib\enchant-2\enchant_hunspell.dll" DestinationFolder="$(HexChatRel)\lib\enchant-2" Condition="Exists('$(DepsRoot)\lib\enchant-2\enchant_hunspell.dll')" />
    <Copy SourceFiles="@(Locale)" DestinationFiles="@(Locale->'$(HexChatRel)\share\locale\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Copy SourceFiles="@(MSWindowsTheme)" DestinationFiles="@(MSWindowsTheme->'$(HexChatRel)\share\themes\MS-Windows\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Copy SourceFiles="@(LuaShare)" DestinationFiles="@(LuaShare->'$(HexChatRel)\share\lua\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Copy SourceFiles="@(LuaLib)" DestinationFiles="@(LuaLib->'$(HexChatRel)\lib\lua\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Copy SourceFiles="@(Typelib)" DestinationFiles="@(Typelib->'$(HexChatRel)\lib\girepository-1.0\%(Filename)%(Extension)')" />
    <Copy SourceFiles="..\..\plugins\python\xchat.py" DestinationFolder="$(HexChatRel)\python" />
    <Copy SourceFiles="..\..\plugins\python\hexchat.py" DestinationFolder="$(HexChatRel)\python" />
    <Copy SourceFiles="..\..\plugins\python\_hexchat.py" DestinationFolder="$(HexChatRel)\python" />
    <WriteLinesToFile File="$(HexChatRel)portable-mode" Lines="2" Overwrite="true" />
    <Copy SourceFiles="@(DepsRootDocs)" DestinationFiles="@(DepsRootDocs->'$(HexChatRel)\share\doc\%(RecursiveDir)%(Filename)%(Extension)')" />
    <!-- Copy CA certificate bundle as cert.pem (expected by ssl.c) -->
    <Copy SourceFiles="@(CACert)" DestinationFiles="$(HexChatRel)\cert.pem" />
  </Target>
</Project>
